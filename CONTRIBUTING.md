# Contributing

This document has helpful information for people wishing to contribute
changes to `pass-ln`.

## Testing the packaging code

If you are tested changes to a packaging format that your system
natively supports, you can just install it directly on your machine
following the instructions (and Makefile targets) in the README.

Otherwise, we provide Docker configuration that can be used to easily
set up an isolated environment for any of the packaging formats
supported by pass-ln, so you can install into that environment and
test functionality. To use it (from `docker` directory):

* Ubuntu/Debian: `make deb-shell`
* Red Hat/Fedora: `make rpm-shell`
* Arch Linux: `make pkgbuild-shell`
* Homebrew: `make homebrew-shell`
* Manual: `./run-in-docker.bash YOUR_FAVORITE_DOCKER_IMAGE bash`

## Running the tests

`pass-ln` has some simple integration tests written using
[ShellSpec](https://shellspec.info/). If you have ShellSpec installed,
you can simply run `shellspec` in the repository to run the tests. You
must have Pass and dependencies installed already.

If you don't want to install ShellSpec, you can use
[Docker](https://www.docker.com/) instead. Simply run `docker build .
-t pass-ln` to build an image with all the dependencies installed, and
then run `./docker/run-in-docker.bash pass-ln shellspec`.

You can also create a pull request, and the tests will be run
automatically by GitHub Actions. You may want to mark such a pull
request as a "draft" until you are ready for it to be reviewed.

## Release process

1. Update the changelog to indicate the version number and date of the
   latest release, and commit.
2. Place a tag on the commit with the new version number, prefixed
   with `v`.
3. Run `make` in the `packaging` directory and verify there are no
   errors.
4. Push the new commit and tag to GitHub.
5. Create a GitHub Release, copy and paste the relevant subsection
   from the changelog into the release notes, and upload the assets in
   `out/x.y.z` that were generated by `make`.
6. In the
   [homebrew-pass-ln](https://github.com/radian-software/homebrew-pass-ln)
   repository, run `./update.sh` to generate a new commit, and push
   it.
7. In the [pass-ln AUR
   repository](https://aur.archlinux.org/packages/pass-ln), run
   `./update.sh` to generate a new commit, and push it. Note: you can
   run `./archlinux-shell.sh` to get a shell with `makepkg` and
   friends installed, if you are not running Arch Linux.
